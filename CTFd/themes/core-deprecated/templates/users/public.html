{% extends "base.html" %}

{% block content %}
<div class="jumbotron">
  <div class="container text-center">
    <h1>{{ user.name }}</h1>

    {% if user.team_id %}
      <h2>
        <a href="{{ url_for('teams.public', team_id=user.team_id) }}">
          <span class="badge badge-secondary">
            {{ user.team.name }}
          </span>
        </a>
      </h2>
    {% endif %}

    {% if user.oauth_id %}
      <span class="badge badge-primary">Official</span>
    {% endif %}

    {# ---- BRANCH FIELD ONLY ---- #}
    <div class="mt-3">
      {% set branch = None %}
      {% for field in user.fields %}
        {% if field.name == 'Branch' %}
          {% set branch = field.value %}
        {% endif %}
      {% endfor %}

      {% if branch %}
        <h3>
          <span class="badge badge-success px-3 py-2">
            Branch: {{ branch }}
          </span>
        </h3>
      {% endif %}
    </div>

    <div class="mt-4">
      {% if account.place %}
        <h4>{{ account.place }} <small>place</small></h4>
        <h4>{{ account.score }} <small>points</small></h4>
      {% endif %}
    </div>
  </div>
</div>

<div class="container">
  {% include "components/errors.html" %}

  {% set solves = user.solves %}
  {% set awards = user.awards %}

  {% if solves or awards %}
    <div class="row">
      <div class="col-md-6 d-none d-md-block">
        <div id="keys-pie-graph" class="d-flex align-items-center">
          <div class="text-center w-100">
            <i class="fas fa-circle-notch fa-spin fa-3x spinner"></i>
          </div>
        </div>
      </div>

      <div class="col-md-6 d-none d-md-block">
        <div id="categories-pie-graph" class="d-flex align-items-center">
          <div class="text-center w-100">
            <i class="fas fa-circle-notch fa-spin fa-3x spinner"></i>
          </div>
        </div>
      </div>
    </div>

    <br>

    {% if awards %}
    <div class="row">
      <div class="col-md-12">
        <h3>Awards</h3>
      </div>

      {% for award in awards %}
        <div class="col-md-3 col-sm-6 text-center">
          <i class="award-icon award-{{ award.icon }} fa-2x"></i>
          <p><strong>{{ award.name }}</strong></p>
          <p>{{ award.value }}</p>
        </div>
      {% endfor %}
    </div>
    {% endif %}

    <br>

    {% if solves %}
    <div class="row">
      <div class="col-md-12">
        <h3>Solves</h3>
        <table class="table table-striped">
          <thead>
            <tr>
              <td><b>Challenge</b></td>
              <td class="d-none d-md-block"><b>Category</b></td>
              <td><b>Value</b></td>
              <td><b>Time</b></td>
            </tr>
          </thead>
          <tbody>
            {% for solve in solves %}
            <tr>
              <td>
                <a href="{{ url_for('challenges.listing') }}#{{ solve.challenge.name }}-{{ solve.challenge.id }}">
                  {{ solve.challenge.name }}
                </a>
              </td>
              <td class="d-none d-md-block">{{ solve.challenge.category }}</td>
              <td>{{ solve.challenge.value }}</td>
              <td>
                <span data-time="{{ solve.date | isoformat }}"></span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% endif %}
  {% else %}
    <div class="text-center opacity-50">
      <h3>No solves yet</h3>
    </div>
  {% endif %}
</div>
{% endblock %}
